# Generated by '{{ .Executable }} makefile'

# Path to the folder containing the libraries for your project.
LIB_PATH = libraries
# Space-delimited list of libraries from LIB_PATH.
LIBRARIES = 
BUILD_PATH = build

BOARD_FQBN = # e.g. arduino:avr:nano
BOARD_OPTIONS = # e.g. cpu=atmega328old

# Adapt this regex to match the range of names your Arduino might appear in /dev/,
# or leave empty for the default: {{ .DefaultRegex }}
PORT_REGEX = 
BAUD_RATE = 115200

### End of configuration ###

LIB_OPTS = $(addprefix --library $(LIB_PATH)/,$(LIBRARIES))
COMPILE_OPTS = \
	--fqbn "$(BOARD_FQBN)" \
	--board-options "$(BOARD_OPTIONS)" \
	$(LIB_OPTS) \
	--build-path "$(BUILD_PATH)"
UPLOAD_OPTS = \
	--fqbn "$(BOARD_FQBN)" \
	--board-options "$(BOARD_OPTIONS)" \
	--input-dir "$(BUILD_PATH)"

PORT_ARG = $(if $(PORT_REGEX),-regex '$(PORT_REGEX)',)

compile:
	arduino-cli compile $(COMPILE_OPTS)

find-board:
	$(eval PORT := $(shell {{ .Executable }} find-board $(PORT_ARG)))
	$(if $(PORT),,$(error "Stopping"))

upload: find-board
	arduino-cli upload $(UPLOAD_OPTS) --port "$(PORT)"

monitor: find-board
	arduino-cli monitor --config baudrate=$(BAUD_RATE) --port "$(PORT)"
